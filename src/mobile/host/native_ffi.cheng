const
    defaultWidth: int32 = 960
    defaultHeight: int32 = 540

type
    MobileHostConfig =
        platform: int32
        resourceRoot: str
        title: str
        width: int32
        height: int32
        highDpi: int32

when defined(android) || defined(ios) || defined(mobile_host):
    @importc("cheng_mobile_host_default_resource_root")
    fn cheng_mobile_host_default_resource_root(): str
    @importc("cheng_mobile_host_init")
    fn cheng_mobile_host_init(cfg: MobileHostConfig*): int32
    @importc("cheng_mobile_host_open_window")
    fn cheng_mobile_host_open_window(cfg: MobileHostConfig*): int32
    @importc("cheng_mobile_host_poll_event_cached")
    fn cheng_mobile_host_poll_event_cached(): int32
    @importc("cheng_mobile_host_cached_event_kind")
    fn cheng_mobile_host_cached_event_kind(): int32
    @importc("cheng_mobile_host_cached_event_pointer_x_i32")
    fn cheng_mobile_host_cached_event_pointer_x_i32(): int32
    @importc("cheng_mobile_host_cached_event_pointer_y_i32")
    fn cheng_mobile_host_cached_event_pointer_y_i32(): int32
    @importc("cheng_mobile_host_cached_event_pointer_delta_x_i32")
    fn cheng_mobile_host_cached_event_pointer_delta_x_i32(): int32
    @importc("cheng_mobile_host_cached_event_pointer_delta_y_i32")
    fn cheng_mobile_host_cached_event_pointer_delta_y_i32(): int32
    @importc("cheng_mobile_host_cached_event_pointer_id")
    fn cheng_mobile_host_cached_event_pointer_id(): int32
    @importc("cheng_mobile_host_cached_event_key_code")
    fn cheng_mobile_host_cached_event_key_code(): int32
    @importc("cheng_mobile_host_cached_event_text")
    fn cheng_mobile_host_cached_event_text(): str
    @importc("cheng_mobile_host_cached_event_message")
    fn cheng_mobile_host_cached_event_message(): str
    @importc("cheng_mobile_host_cached_event_time_ms")
    fn cheng_mobile_host_cached_event_time_ms(): int64
    @importc("cheng_mobile_host_present")
    fn cheng_mobile_host_present(pixels: void*, width, height, strideBytes: int32)
    @importc("cheng_mobile_host_shutdown")
    fn cheng_mobile_host_shutdown(reason: str)
    @importc("cheng_mobile_host_debug_state")
    fn cheng_mobile_host_debug_state(phase: str, a, b, c, d: int32)

    @importc("cheng_mobile_bus_send_envelope")
    fn cheng_mobile_bus_send_envelope(serviceKind, methodKind, flags: int32, requestId, payloadCbor: str): int32
    @importc("cheng_mobile_bus_recv_envelope")
    fn cheng_mobile_bus_recv_envelope(): str
    @importc("cheng_mobile_capability_query_i64")
    fn cheng_mobile_capability_query_i64(): int64
    @importc("cheng_mobile_shm_alloc_handle")
    fn cheng_mobile_shm_alloc_handle(sizeBytes: int64, usageFlags: int32): int32
    @importc("cheng_mobile_shm_free")
    fn cheng_mobile_shm_free(handle: int32): int32
    @importc("cheng_mobile_shm_size_bytes_i64")
    fn cheng_mobile_shm_size_bytes_i64(handle: int32): int64

    @importc("cheng_mobile_host_runtime_state_json")
    fn cheng_mobile_host_runtime_state_json(): str
    @importc("usleep")
    fn usleep(usec: uint32): int32

    when defined(android):
        @importc("cheng_mobile_host_android_width")
        fn cheng_mobile_host_android_width(): int32
        @importc("cheng_mobile_host_android_height")
        fn cheng_mobile_host_android_height(): int32
        @importc("cheng_mobile_host_android_density_scale")
        fn cheng_mobile_host_android_density_scale(): float64
        @importc("cheng_mobile_host_android_ime_inset_bottom")
        fn cheng_mobile_host_android_ime_inset_bottom(): int32
        @importc("chengGuiNativeDrawTextBgraI32")
        fn chengGuiNativeDrawTextBgraI32(
            pixels: void*,
            width, height, strideBytes: int32,
            x, y: int32,
            color: uint32,
            fontSizePx: int32,
            text: str
        ): int32
        @importc("chengGuiNativeMeasureTextWidthPxI32")
        fn chengGuiNativeMeasureTextWidthPxI32(text: str, fontSizePx: int32): int32
    else:
        @weak
        fn cheng_mobile_host_android_width(): int32 =
            return 0
        @weak
        fn cheng_mobile_host_android_height(): int32 =
            return 0
        @weak
        fn cheng_mobile_host_android_density_scale(): float64 =
            return 0.0
        @weak
        fn cheng_mobile_host_android_ime_inset_bottom(): int32 =
            return 0
        @weak
        fn chengGuiNativeDrawTextBgraI32(
            pixels: void*,
            width, height, strideBytes: int32,
            x, y: int32,
            color: uint32,
            fontSizePx: int32,
            text: str
        ): int32 =
            pixels
            width
            height
            strideBytes
            x
            y
            color
            fontSizePx
            text
            return 0
        @weak
        fn chengGuiNativeMeasureTextWidthPxI32(text: str, fontSizePx: int32): int32 =
            text
            fontSizePx
            return 0
else:
    @weak
    fn cheng_mobile_host_default_resource_root(): str =
        return ""
    @weak
    fn cheng_mobile_host_init(cfg: MobileHostConfig*): int32 =
        cfg
        return 0
    @weak
    fn cheng_mobile_host_open_window(cfg: MobileHostConfig*): int32 =
        cfg
        return 0
    @weak
    fn cheng_mobile_host_poll_event_cached(): int32 =
        return 0
    @weak
    fn cheng_mobile_host_cached_event_kind(): int32 =
        return 0
    @weak
    fn cheng_mobile_host_cached_event_pointer_x_i32(): int32 =
        return 0
    @weak
    fn cheng_mobile_host_cached_event_pointer_y_i32(): int32 =
        return 0
    @weak
    fn cheng_mobile_host_cached_event_pointer_delta_x_i32(): int32 =
        return 0
    @weak
    fn cheng_mobile_host_cached_event_pointer_delta_y_i32(): int32 =
        return 0
    @weak
    fn cheng_mobile_host_cached_event_pointer_id(): int32 =
        return -1
    @weak
    fn cheng_mobile_host_cached_event_key_code(): int32 =
        return 0
    @weak
    fn cheng_mobile_host_cached_event_text(): str =
        return ""
    @weak
    fn cheng_mobile_host_cached_event_message(): str =
        return ""
    @weak
    fn cheng_mobile_host_cached_event_time_ms(): int64 =
        return int64(0)
    @weak
    fn cheng_mobile_host_present(pixels: void*, width, height, strideBytes: int32) =
        pixels
        width
        height
        strideBytes
    @weak
    fn cheng_mobile_host_shutdown(reason: str) =
        reason
    @weak
    fn cheng_mobile_host_debug_state(phase: str, a, b, c, d: int32) =
        phase
        a
        b
        c
        d
    @weak
    fn cheng_mobile_bus_send_envelope(serviceKind, methodKind, flags: int32, requestId, payloadCbor: str): int32 =
        serviceKind
        methodKind
        flags
        requestId
        payloadCbor
        return 0
    @weak
    fn cheng_mobile_bus_recv_envelope(): str =
        return ""
    @weak
    fn cheng_mobile_capability_query_i64(): int64 =
        return int64(0)
    @weak
    fn cheng_mobile_shm_alloc_handle(sizeBytes: int64, usageFlags: int32): int32 =
        sizeBytes
        usageFlags
        return 0
    @weak
    fn cheng_mobile_shm_free(handle: int32): int32 =
        handle
        return 0
    @weak
    fn cheng_mobile_shm_size_bytes_i64(handle: int32): int64 =
        handle
        return int64(0)
    @weak
    fn cheng_mobile_host_runtime_state_json(): str =
        return "{\"native_ready\":false,\"started\":false,\"last_error\":\"native_not_ready\"}"
    @weak
    fn cheng_mobile_host_android_width(): int32 =
        return 0
    @weak
    fn cheng_mobile_host_android_height(): int32 =
        return 0
    @weak
    fn cheng_mobile_host_android_density_scale(): float64 =
        return 0.0
    @weak
    fn cheng_mobile_host_android_ime_inset_bottom(): int32 =
        return 0
    @weak
    fn chengGuiNativeDrawTextBgraI32(
        pixels: void*,
        width, height, strideBytes: int32,
        x, y: int32,
        color: uint32,
        fontSizePx: int32,
        text: str
    ): int32 =
        pixels
        width
        height
        strideBytes
        x
        y
        color
        fontSizePx
        text
        return 0
    @weak
    fn chengGuiNativeMeasureTextWidthPxI32(text: str, fontSizePx: int32): int32 =
        text
        fontSizePx
        return 0
    @weak
    fn usleep(usec: uint32): int32 =
        usec
        return 0

fn buildHostConfig(title: str): MobileHostConfig =
    var cfg: MobileHostConfig
    cfg.platform = 0
    cfg.resourceRoot = cheng_mobile_host_default_resource_root()
    cfg.title = title
    cfg.width = defaultWidth
    cfg.height = defaultHeight
    cfg.highDpi = 1
    return cfg
